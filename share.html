<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Simple HTML Editor</title>
<style>
    textarea,
    iframe {
      width: 300px;
      height: 200px;
    }
  </style>
</head>
<body>
<textarea id="code"></textarea>
<iframe id="preview"></iframe>
<button id="share">Share</button>
<script>
  const textarea = document.getElementById('code');
  const iframe = document.getElementById('preview');
  const shareButton = document.getElementById('share');

  // Generate a unique identifier.
  function generateId() {
    const possibleChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let id = '';

    for (let i = 0; i < 10; i++) {
      id += possibleChars.charAt(Math.floor(Math.random() * possibleChars.length));
    }

    return id;
  }

  // Save the code and generate a shareable identifier.
  function saveCode() {
    const code = textarea.value;
    const id = generateId();

    localStorage.setItem(id, code);
  }

  // Update the iframe preview with the textarea content.
  function preview() {
    iframe.srcdoc = textarea.value;
  }

  // Copy the shareable identifier to the clipboard.
  function share() {
    // Obtain the first key from localStorage
    let id = '';
    for (let i = 0; i < localStorage.length; i++) {
      const key = localStorage.key(i);
      id = key;
      break;
    }

    if (id) {
      navigator.clipboard.writeText(window.location.href + '?id=' + id);
    }
  }

  // Initialize the editor with the code from the provided identifier.
  function initializeEditor() {
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');

    if (id) {
      const code = localStorage.getItem(id);
      textarea.value = code;
    }
  }

  // Add event listeners.
  textarea.addEventListener('input', preview);
  textarea.addEventListener('input', saveCode);
  shareButton.addEventListener('click', share);

  // Initialize the editor.
  initializeEditor();
</script>
</body>
</html>
