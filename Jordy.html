<!DOCTYPE html>
<html>

<head>
  <title>Duplicate browser tab ignores form elements current values</title>
  <style>
    body {
      display: grid;
      grid-template-columns: repeat(2, max-content);
      gap: 1em 0.5em;
    }

    body.Dark {
      color: white;
      background: black;
    }
  </style>
</head>

<body>
  <textarea>Hello, world!</textarea>
  <p></p>
  <input type="range" />
  <output></output>
  <input type="checkbox" />
  <span></span>
  <select>
      <option>Light</option>
      <option>Dark</option>
    </select>
  <script>
    var textarea = document.querySelector("textarea");
      var p = document.querySelector("p");
      var range = document.querySelector('input[type="range"]');
      var output = document.querySelector("output");
      var checkbox = document.querySelector('input[type="checkbox"]');
      var span = document.querySelector("span");
      var theme = document.querySelector("select");
      let currentSession = JSON.parse(localStorage.getItem('data')) || {};
      
      function createSessionStorage() {
        let newSession = {
          textarea: textarea.value,
          range: range.value,
          checkbox: checkbox.checked,
          theme: theme.value,
        };
        localStorage.setItem('data', JSON.stringify(newSession));
      }

      function applySessionStorage() {
        setTimeout(()=>{
          textarea.value = currentSession["textarea"] ? currentSession["textarea"] : textarea.value;
          range.value = currentSession["range"] ? currentSession["range"] : range.value;
          checkbox.checked = currentSession["checkbox"] ? currentSession["checkbox"] : checkbox.checked;
          theme.value = currentSession["theme"] ? currentSession["theme"] : theme.value;
          write();
        },1);
      }

      function write() {
        textarea.innerHTML = textarea.value;
        p.textContent = textarea.value;
        output.textContent = range.value;
        span.textContent = checkbox.checked;
        document.body.className = theme.value;
        createSessionStorage();
      }

      textarea.addEventListener("input", write);
      range.addEventListener("input", write);
      checkbox.addEventListener("change", write);
      theme.addEventListener("change", write);

      applySessionStorage();
  </script>
</body>

</html>
