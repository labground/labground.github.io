<!doctype html>
<html lang="en">
<head>
  <title>Firefox Bug</title>
  <style>
    body.dark {
      background: black;
    }

    button.active {
      background: aqua;
    }
  </style>
</head>
<body>
  <select>
    <option value="light">Light</option>
    <option value="dark">Dark</option>
  </select>
  <button>Hello, world!</button>
  <script>
    const select = document.querySelector('select');
    const button = document.querySelector('button');

    function toggleBodyTheme() {
      document.body.className = select.value;
    }

    function toggleButtonBackground() {
      button.classList.toggle('active');
    }

    select.addEventListener('change', toggleBodyTheme);
    button.addEventListener('click', toggleButtonBackground);

    function saveState() {
      localStorage.setItem('select', select.value);
      localStorage.setItem('button', button.className);
    }

    // Save the current state to localStorage.
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        saveState();
      }
    });

    // Restore the state from localStorage.
    const savedSelectValue = localStorage.getItem('select');
    const savedButtonClass = localStorage.getItem('button');

    if (savedSelectValue) {
      select.value = savedSelectValue;
      document.body.className = savedSelectValue;
    }

    if (savedButtonClass) {
      button.className = savedButtonClass;
    }
  </script>
</body>
</html>